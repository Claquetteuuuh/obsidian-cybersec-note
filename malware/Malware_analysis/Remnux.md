https://docs.remnux.org/ is a VM used for (**R**everse **E**ngineering **M**alware Li**nux**).
## Examining the file type
To find the file type of a file we can use the file command:
```bash
$ file wannacry 
wannacry: PE32 executable (GUI) Intel 80386, for MS Windows
```
## Examining strings
To look at the strings used in the malware the strings command can be used:
```bash
$ strings wannacry
```
You can use `|less` or `|more` to have a better vision.
```shell
$ strings wannacry | less
```
## Calculating hashes
File Hashing provides us with a fixed-size unique number that identifies a file. Siimilar to Social Security Numbers or National Identification Numbers used for the citizens of a country.
```shell
$ md5sum wannacry 
84c82835a5d21bbcf75a61706d8ab549  wannacry
```

You can do the same with `md5sum`, `sha1sum` and `sha256sum`

Then you can use VirusTotal to do CTI on the file.
## PE Header
The header contains the metadata about a Portable Executable file.
This data can help us find a lot of helpful information to help us in our analysis.

![[Pasted image 20250314151800.png]]
### Imports/Exports
A PE file seldom contains all the code that it needs to run on a system on its own.
Most of the time it re-uses code provided by the Operating System.
This is done to use less space.
Imports are such functions that the PE file imports from outside to perform different tasks.

For example, if a developer wants to Query a Windows Registry value, they will import the [RegQueryValue](https://docs.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regqueryvaluew) function provided by Microsoft instead of writing the code themselves. It is understood that this function will be present on any Windows machine on which the developer's code is going to run, so it does not need to be included in the PE file itself.
### Sections
Another useful piece of information available in the PE file header is the information about sections in the PE file. A PE file is divided into different sections which have different purposes.
- .**text:** This Section generally contains the CPU instructions executed when the PE file is run. This section is marked as executable.
- **.data:** This Section contains the global variables and other global data used by the PE file.
- **.rsrc:** This Section contains resources that are used by the PE file, for example, images, icons, etc.
## Analyzing PE header using pecheck utility
You can use the `pecheck` command to analyse it
```shell
$ pecheck wannacry 
PE check for 'wannacry':
Entropy: 7.995471 (Min=0.0, Max=8.0)
MD5     hash: 84c82835a5d21bbcf75a61706d8ab549
SHA-1   hash: 5ff465afaabcbf0150d1a3ab2c2e74f3a4426467
SHA-256 hash: ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa
SHA-512 hash: 90723a50c20ba3643d625595fd6be8dcf88d70ff7f4b4719a88f055d5b3149a4231018ea30d375171507a147e59f73478c0c27948590794554d031e7d54b7244
.text entropy: 6.404235 (Min=0.0, Max=8.0)
.rdata entropy: 6.663571 (Min=0.0, Max=8.0)
.data entropy: 4.455750 (Min=0.0, Max=8.0)
.rsrc entropy: 7.999868 (Min=0.0, Max=8.0)
Dump Info:
----------DOS_HEADER----------

[IMAGE_DOS_HEADER]
0x0        0x0   e_magic:                       0x5A4D    
0x2        0x2   e_cblp:                        0x90      
0x4        0x4   e_cp:                          0x3       
0x6        0x6   e_crlc:                        0x0       
0x8        0x8   e_cparhdr:                     0x4       
0xA        0xA   e_minalloc:                    0x0       
0xC        0xC   e_maxalloc:                    0xFFFF    
0xE        0xE   e_ss:                          0x0       
0x10       0x10  e_sp:                          0xB8      
0x12       0x12  e_csum:                        0x0       
0x14       0x14  e_ip:                          0x0       
0x16       0x16  e_cs:                          0x0       
0x18       0x18  e_lfarlc:                      0x40      
0x1A       0x1A  e_ovno:                        0x0       
0x1C       0x1C  e_res:                         
0x24       0x24  e_oemid:                       0x0       
0x26       0x26  e_oeminfo:                     0x0       
0x28       0x28  e_res2:                        
0x3C       0x3C  e_lfanew:                      0xF8      

----------NT_HEADERS----------

[IMAGE_NT_HEADERS]
0xF8       0x0   Signature:                     0x4550    

----------FILE_HEADER----------

[IMAGE_FILE_HEADER]
0xFC       0x0   Machine:                       0x14C     
0xFE       0x2   NumberOfSections:              0x4       
0x100      0x4   TimeDateStamp:                 0x4CE78F41 [Sat Nov 20 09:05:05 2010 UTC]
0x104      0x8   PointerToSymbolTable:          0x0       
0x108      0xC   NumberOfSymbols:               0x0       
0x10C      0x10  SizeOfOptionalHeader:          0xE0      
0x10E      0x12  Characteristics:               0x10F     
Flags: IMAGE_FILE_32BIT_MACHINE, IMAGE_FILE_EXECUTABLE_IMAGE, IMAGE_FILE_LINE_NUMS_STRIPPED, IMAGE_FILE_LOCAL_SYMS_STRIPPED, IMAGE_FILE_RELOCS_STRIPPED
(...)

[IMAGE_SECTION_HEADER]
0x240      0x0   Name:                          .data
0x248      0x8   Misc:                          0x1958    
0x248      0x8   Misc_PhysicalAddress:          0x1958    
0x248      0x8   Misc_VirtualSize:              0x1958    
0x24C      0xC   VirtualAddress:                0xE000    
0x250      0x10  SizeOfRawData:                 0x2000    
0x254      0x14  PointerToRawData:              0xE000    
0x258      0x18  PointerToRelocations:          0x0       
0x25C      0x1C  PointerToLinenumbers:          0x0       
0x260      0x20  NumberOfRelocations:           0x0       
0x262      0x22  NumberOfLinenumbers:           0x0       
0x264      0x24  Characteristics:               0xC0000040
Flags: IMAGE_SCN_CNT_INITIALIZED_DATA, IMAGE_SCN_MEM_READ, IMAGE_SCN_MEM_WRITE
Entropy: 4.455750 (Min=0.0, Max=8.0)
MD5     hash: 83506e37bd8b50cacabd480f8eb3849b
SHA-1   hash: 7bd2238995e2286a24e92667f161a3c14506d4e1
SHA-256 hash: 110357de37bd422f6c68b66035e4652b99767819353f4c398953249a930fa823
SHA-512 hash: f606cfb3aa76a5cd4077b91ca5ef0577421494a904f6b1e721c2925d795a060681b5ebdb3873072992592fb2e21e9a1a29ec7d94bf2f53c5d618db24496ef7a9
```

You can use the GUI tool:
```shell
$ pe-tree <file>
```
### PeID
To see the name of the packer entity you can use PeID.
![[Pasted image 20250314193821.png]]
### PeePDF
A tool use to scan suspicious elements in PDF:
```shell
$ peepdf demo_notsuspicious.pdf
```

#### Script
You can create a string to get the javascript from a pdf:
```shell
$ echo 'extract js > javascript-from-demo_notsuspicious.pdf' > extracted_javascript.txt
```
You can extract the javascript with the `-s` parameter:
```shell
$ peepdf -s extracted_javascript.txt demo_notsuspicious.pdf
```
### Vmonkey
Vmonkey is a tool to get the macro in a doc text.
```shell
$ vmonkey fichier.doc
```

