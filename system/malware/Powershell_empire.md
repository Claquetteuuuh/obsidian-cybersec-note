
**Powershell empire** est un **framework** d'**exploitation** et de **post-exploitation** fait principalement en **powershell**.

## __Installation__

### Kali-linux

```shell
$ sudo apt install powershell-empire -y 
$ powershell-empire
```

### Github

```shell
$ sudo apt install python3-pip
$ sudo pip3 install poetry
$ git clone --recursive https://github.com/BC-SECURITY/Empire.git
$ cd Empire
$ sudo ./setup/install.sh
$ sudo poetry install
```


## __Start__

### Kali-linux

Dans un premier terminal lancer la commande :

```shell
$ powershell-empire server
```

Dans un second onglet, lancer la commande :

```shell
$ powershell-empire client
```


### Other

Dans un premier terminal lancer la commande :

```shell
$ sudo poetry run python3 empire.py server
```

Dans un second onglet, lancer la commande :

```shell
$ sudo poetry run python3 empire.py client
```


## __Usage__

### __Help__

La commande help affiche les commande et leur usage.

```shell
(Empire) > help

┌Help Options───┬──────────────────────────────────────────────────────────────────────────────────────────────────────────┬────────────────────────────────────┐
│ Name          │ Description                                                                                              │ Usage                              │
├───────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────┤
│ admin         │ View admin menu                                                                                          │ admin                              │
├───────────────┼──────────────────────────────────────────────────────────────────────────
 ...
├───────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────┤
│ useplugin     │ Use an Empire plugin.                                                                                    │ useplugin <plugin_name>            │
├───────────────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────┤
│ usestager     │ Use an Empire stager.                                                                                    │ usestager <stager_name>            │
└───────────────┴──────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────────────────────────┘

```


### __Listeners__

Pour mettre en place une connection entre une machine distante et la notre, on doit mettre en place un listener.

Pour entrer dans le contexte listener, on effectue la commande :

```shell
(Empire) > listeners

┌Listeners List────────┬──────────────────────────────────────┬─────────┐
│ ID │ Name │ Template │ Created At                           │ Enabled │
└────┴──────┴──────────┴──────────────────────────────────────┴─────────┘

(Empire: listeners) >
```

#### uselistener

Pour selectionner un listener on effectue la commande **`uselistener <PROTOCOLE>`** :

```shell
(Empire: listeners) > uselistener http

 id           http                                                                  
 authors      Will Schroeder, @harmj0y, https://twitter.com/harmj0y                 
 description  Starts a http[s] listener (PowerShell or Python) that uses a GET/POST 
              approach.                                                             
 category     client_server                                                         


┌Record Options────┬─────────────────────────────────────┬──────────┬─────────────────────────────────────┐
│ Name             │ Value                               │ Required │ Description                         │
├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤
│ Name             │ http                                │ True     │ Name for the listener.              │
├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤
│ Host             │ http://192.168.106.132              │ True     │ Hostname/IP for staging.            │
├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤
│ BindIP           │ 0.0.0.0                             │ True     │ The IP to bind to on the control    │
│                  │                                     │          │ server.                             │
├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤
│ Port             │                                     │ True     │ Port for the listener.              │
├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤
│ Launcher         │ powershell -noP -sta -w 1 -enc      │ True     │ Launcher string.                    │
├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤
(...)
├──────────────────┼─────────────────────────────────────┼──────────┼─────────────────────────────────────┤
│ JA3_Evasion      │ False                               │ True     │ Randomly generate a JA3/S signature │
│                  │                                     │          │ using TLS ciphers.                  │
└──────────────────┴─────────────────────────────────────┴──────────┴─────────────────────────────────────┘
```

Il existe une multitude de listeners :

| **Name**      | **Description**                                                                                                                                    |
| ------------- | -------------------------------------------------------------------------------------------------------------------------------------------------- |
| **dbx**       | Passe par dropbox, un service cloud tiers à premiere vue neutre pour les équipes de défense. Permet de ne jamais exposer le réseau de l'attaquant. |
| **http_com**  | Mode classique sur HTTPS à travers un objet COM caché pour Internet Explorer, permettant une communication au travers de ce composant.             |
| **http_hop**  | Redirige les communications vers un autre listener                                                                                                 |
| **http_mapi** | Protocole utilisé par les infra Microsoft Exchange (outlook poiur la messagerie), rarement supervisé dinement dans les SI.                         |
| **onedrive**  | Comme dropbox mais pour onedrive.                                                                                                                  |
| **http**      | Mode le plus simple à travers HTTP                                                                                                                                                   |
