
**Metasploit** est un **framework** d'exploitation qui regroupe énormement d'outil pour **trouver et exploiter des vulnérabilitées**.

L'interface de metasploit est basé sur des modules, on peut trouver plusieurs catégories de modules :
- **[Auxiliary](#__Auxiliary__)**
- **[Encoders](#__Encoders__)**
- **[Evasions](#__Evasions__)**
- **[Exploits](#__Exploits__)**
- **[NOP](#__NOP__)**
- **[Payloads](#__Payloads__)**
- **[Post](#__Post__)**

## __Auxiliary__

Le module **Auxiliary** regroupe tous les supports comme les **scanners**, les **crawlers** et les **fuzzers**

```shell
root@ip:/opt/metasploit-framework/embedded/framework/modules# tree -L 1 auxiliary/
auxiliary/ 
├── admin 
├── analyze 
├── bnat 
├── client 
├── cloud 
├── crawler
├── docx 
├── dos 
├── example.py
├── example.rb 
├── fileformat
├── fuzzers 
├── gather
├── parser 
├── pdf 
├── scanner
├── server 
├── sniffer 
├── spoof 
├── sqli
├── voip 
└── vsploit

20 directories, 2 files
```


## __Encoders__

Les **encodeurs** permettent d'**[encoder](Encryption_Chiffrement) nos payload**.
Les antivirus sont **basé sur des DBs de menaces connues**. Pour détecter les menaces ils comparent le fichiers à la DB et déclanche une alerte si un virus est reconnu. Ils peuvent effectuer des **vérifications supplémentaire qui réduiront le taux de réussite des encodeurs**.

```shell
root@ip:/opt/metasploit-framework/embedded/framework/modules# tree -L 1 encoders/
encoders/ 
├── cmd
├── generic 
├── mipsbe 
├── mipsle 
├── php
├── ppc
├── ruby
├── sparc
├── x64
└── x86

10 directories, 0 files
```


## __Evasions__

Les **évasions** ont pour but de **bypass les antivirus** avec plus ou moins de succès.

```shell
root@ip:/opt/metasploit-framework/embedded/framework/modules# tree -L 2 evasion/
evasion/
└── windows
	├── applocker_evasion_install_util.rb
	├── applocker_evasion_msbuild.rb
	├── applocker_evasion_presentationhost.rb
	├── applocker_evasion_regasm_regsvcs.rb
	├── applocker_evasion_workflow_compiler.rb
	├── process_herpaderping.rb
	├── syscall_inject.rb
	├── windows_defender_exe.rb
	└── windows_defender_js_hta.rb

1 directory, 9 files
```


## __Exploits__

Des **exploits** organisés par **systemes ciblé**.

```shell
root@ip:/opt/metasploit-framework/embedded/framework/modules# tree -L 1 exploits/ 
exploits/ 
├── aix 
├── android
├── apple_ios 
├── bsd 
├── bsdi
├── dialup 
├── example_linux_priv_esc.rb 
├── example.py 
├── example.rb 
├── example_webapp.rb 
├── firefox
├── freebsd
├── hpux
├── irix 
├── linux
├── mainframe
├── multi 
├── netware 
├── openbsd
├── osx 
├── qnx 
├── solaris
├── unix 
└── windows 

20 directories, 4 files
```


## __NOP__

Les **NOp** (No Operation) **ne font rien**, Ils sont représentés dans la famille de processeurs Intel x86, ils sont représentés par **0x90**, après quoi le CPU ne fera rien pendant un cycle. Ils sont utilisé comme **buffer** pour **obtenir des tailles de payload cohérente**.

```shell
root@ip:/opt/metasploit-framework/embedded/framework/modules# tree -L 1 nops/ 
nops/
├── aarch64 
├── armle
├── cmd
├── mipsbe
├── php
├── ppc 
├── sparc 
├── tty 
├── x64 
└── x86 

10 directories, 0 files
```


## __Payloads__ 

Les **payloads** sont les **codes** qui vont **être éxécuté par le systeme ciblé**.

Les [exploits](#__Exploits__) vont servir a tirer partie d'une vulnérabilité du systeme mais ce sont les payloads qui vont nous permettre d'arriver au resultat souhaité.

Dans nos **payloads** on pourra notamment trouver des **shells** qui nous seront utile pour interagir avec la machine ciblé.

```shell
root@ip:/opt/metasploit-framework/embedded/framework/modules# tree -L 1 payloads/ 
payloads/ 
├── adapters 
├── singles 
├── stagers 
└── stages

4 directories, 0 files
```

- **Adapters**, il va **encapsuler des payloads** singles pour les **convertir dans plusieurs formats**.
- **Singles**, Payloads **autonomes**, ils n'ont **pas besoin de télécharger des composants externe** pour s'éxécuter
- **Stagers**, ils servent à **appeler les autres stages du payload**, notre payload va d'abord télécharger le stager sur le systeme puis celui-ci va télécharger le reste du payload. C'est **très utile pour avoir un fichier relativement petit** par rapport à un single.
- **Stages**, ce sont les **composantes téléchargé par le stagers**.

Pour faire la **difference entre les singles et les staged**, metasploit organise ses fichiers de la manière suivante:
 - **generic/shell_reverse_tcp** => **single** car il est en un bloc
 - **windows/x64/shell/reverse_tcp** => **staged** car il est dans un dossier (séparé par un **/** )


## __Post__

Les Posts seront les modules utiles à la dernière étape de l'intrusion, après avoir utilisé les modules précédent.

```shell
root@ip:/opt/metasploit-framework/embedded/framework/modules# tree -L 1 post/ 
post/
├── aix 
├── android 
── apple_ios 
├── bsd 
├── firefox
├── hardware 
├── linux 
├── multi 
├── networking
├── osx 
├── solaris └── windows 12 directories, 0 files
```